# ğŸ§ª Playwright API Testing - ServeRest

[![Playwright](https://img.shields.io/badge/Playwright-Python-45ba63.svg)](https://playwright.dev/python/)
[![Pytest](https://img.shields.io/badge/Pytest-8.4.2-blue.svg)](https://docs.pytest.org/en/stable/)
[![Python](https://img.shields.io/badge/Python-3.10+-yellow.svg)](https://www.python.org/)

Projeto de automaÃ§Ã£o de testes de API utilizando **Microsoft Playwright para Python** em conjunto com **pytest** para testar a API REST **ServeRest** - uma API gratuita que simula uma loja virtual.

Projeto estruturado com boas prÃ¡ticas, exemplos de testes, validaÃ§Ãµes avanÃ§adas e integraÃ§Ã£o com Pytest para execuÃ§Ã£o e relatÃ³rios Allure.

URI do repositÃ³rio: [https://github.com/reinaldorossetti/playwright-python-api-serverest](https://github.com/reinaldorossetti/playwright-python-api-serverest)

Testes realizados na API com Python + Pytest: [TESTING_API_PYTHON.MD](TESTING_API_PYTHON.MD)

---

## ğŸ“š Ãndice

- [Sobre o Playwright](#-sobre-o-playwright)
- [Sobre a API ServeRest](#-sobre-a-api-serverest)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [PrÃ©-requisitos](#-prÃ©-requisitos)
- [Python no Projeto](#-python-no-projeto)
- [InstalaÃ§Ã£o](#-instalaÃ§Ã£o)
- [Executando os Testes](#-executando-os-testes)
- [Exemplos de Testes](#-exemplos-de-testes)
- [Funcionalidades do Playwright](#-funcionalidades-do-playwright)
- [RelatÃ³rios](#-relatÃ³rios)
- [Boas PrÃ¡ticas](#-boas-prÃ¡ticas)
- [Recursos Adicionais](#-recursos-adicionais)

---

## ğŸ§ª Sobre o Playwright

**Playwright** Ã© um framework open-source da Microsoft, conhecido por testes E2E em browser e tambÃ©m por uma API robusta para testes HTTP via `APIRequestContext`, ideal para automaÃ§Ã£o de APIs em Python.

### âœ¨ Principais CaracterÃ­sticas

- **ğŸ”¥ APIRequestContext fluente**: RequisiÃ§Ãµes HTTP com `get`, `post`, `put`, `delete`
- **ğŸš€ Suporte completo a REST**: operaÃ§Ãµes GET, POST, PUT, PATCH e DELETE com JSON
- **ğŸ¯ Assertions nativas do Python**: validaÃ§Ãµes claras e objetivas com `assert`
- **ğŸ”„ Contexto reutilizÃ¡vel**: configuraÃ§Ã£o de `base_url`, headers e ciclo de vida via dependÃªncias/fixtures do pytest
- **ğŸ“Š IntegraÃ§Ã£o com Allure**: relatÃ³rios ricos de execuÃ§Ã£o com pytest
- **ğŸ§ª Data-Driven Testing**: suporte com `@pytest.mark.parametrize` e leitura de CSV
- **âš¡ ExecuÃ§Ã£o Paralela**: execuÃ§Ã£o simultÃ¢nea de testes via `pytest-xdist`
- **ğŸ” AutenticaÃ§Ã£o**: suporte total para tokens e headers customizados

### ğŸ’¡ Por que usar Playwright para API em Python?

1. **PadronizaÃ§Ã£o**: mesmo framework para API e UI quando necessÃ¡rio
2. **Confiabilidade**: cliente HTTP moderno, veloz e estÃ¡vel
3. **IntegraÃ§Ã£o**: funciona naturalmente e se integra perfeitamente com pytest
4. **EvoluÃ§Ã£o**: ecossistema ativo e muito bem documentado
5. **CI/CD**: fÃ¡cil integraÃ§Ã£o com GitHub Actions

---

## ğŸŒ Sobre a API ServeRest

[ServeRest](https://serverest.dev/) Ã© uma API REST gratuita que simula uma loja virtual para fins educacionais e prÃ¡tica de testes de API.

### ğŸ›ï¸ Endpoints DisponÃ­veis

| Recurso | Endpoints | DescriÃ§Ã£o |
|---------|-----------|-----------|
| **Login** | `POST /login` | AutenticaÃ§Ã£o de usuÃ¡rios |
| **UsuÃ¡rios** | `GET, POST, PUT, DELETE /usuarios` | Gerenciamento de usuÃ¡rios |
| **Produtos** | `GET, POST, PUT, DELETE /produtos` | Gerenciamento de produtos (requer admin) |
| **Carrinhos** | `GET, POST, DELETE /carrinhos` | Gerenciamento de carrinhos de compras |

### ğŸ”— Base URL

```text
https://serverest.dev
```

### ğŸ“– DocumentaÃ§Ã£o Completa

- **Swagger UI**: https://serverest.dev/
- **RepositÃ³rio**: https://github.com/ServeRest/ServeRest
- **Front-end (Beta)**: https://front.serverest.dev/

---

## ğŸ“ Estrutura do Projeto

```text
playwright-python-api-serverest/
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ci.yml                       # Pipeline de CI
â”‚
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ conftest.py                      # ConfiguraÃ§Ã£o base e fixtures do Pytest
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ test_login_playwright.py
â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â””â”€â”€ test_users_playwright.py
â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â””â”€â”€ test_products_playwright.py
â”‚   â”œâ”€â”€ carts/
â”‚   â”‚   â””â”€â”€ test_carts_playwright.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ api_utils.py                 # FunÃ§Ãµes Ãºteis de requests e endpoints
â”‚   â”‚   â””â”€â”€ faker_utils.py               # GeraÃ§Ã£o de dados de teste (Faker)
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ login/
â”‚       â”‚   â”œâ”€â”€ invalid-login-emails.csv
â”‚       â”‚   â””â”€â”€ invalido-login.csv
â”‚       â”œâ”€â”€ usuarios/
â”‚       â”‚   â””â”€â”€ userPayload.json
â”‚       â””â”€â”€ produtos/
â”‚           â”œâ”€â”€ productPayload.json
â”‚           â””â”€â”€ product.csv
â”‚
â”œâ”€â”€ pytest.ini                           # ConfiguraÃ§Ãµes gerais do pytest (dist e allure)
â”œâ”€â”€ requirements.txt                     # DependÃªncias do projeto Python
â”œâ”€â”€ TESTING_API_PYTHON.MD                # DocumentaÃ§Ã£o dos cenÃ¡rios de teste em Python
â””â”€â”€ readme.MD                            # Este arquivo
```

---

## ğŸ”§ PrÃ©-requisitos

- **Python 3.10** ou superior
- **pip** (Gerenciador de pacotes do Python)
- **Virtual Environment** (recomendado usar `venv` ou similar)
- **IDE** (VS Code, PyCharm)
- ConexÃ£o com internet (para acessar a API ServeRest)

### Verificar instalaÃ§Ã£o

```bash
python --version
pip --version
```

---

## ğŸ Python no Projeto

Este projeto utiliza recursos nativos e modernos do **Python** em sinergia com o **Pytest** para entregar testes legÃ­veis, independentes e fÃ¡ceis de dar manutenÃ§Ã£o.

### âœ… Exemplos prÃ¡ticos usados no projeto

1. **DicionÃ¡rios nativos para payloads JSON**

```python
payload = {
    "nome": product_name,
    "preco": 250,
    "descricao": "Produto de teste",
    "quantidade": 10
}
```

2. **Fixtures do Pytest para injeÃ§Ã£o de dependÃªncia (`conftest.py`)**

```python
@pytest.fixture
def api_request(playwright_instance: Playwright):
    request_context = playwright_instance.request.new_context(base_url=BASE_URL)
    yield request_context
    request_context.dispose()
```

3. **Tipagem e Autocomplete (`Type Hints`)**

```python
def create_user(request: APIRequestContext, email: str, password: str, admin: bool):
    pass
```

### ğŸ’¡ Boas prÃ¡ticas com Python para este projeto

- Mantenha `pytest.ini` e `conftest.py` otimizados para orquestrar setup/teardown.
- Use dicionÃ¡rios nativos para body das requisiÃ§Ãµes, ao invÃ©s de conversÃ£o manual de texto.
- Foque na clareza do cÃ³digo, usando as asserÃ§Ãµes nativas (`assert`).

---

## ğŸ“¦ DependÃªncias e VersÃµes (requirements.txt)

| Componente                         | VersÃ£o  | DescriÃ§Ã£o  |
|------------------------------------|---------|------------|
| `pytest`                           | 8.4.2   | Framework principal de testes unitÃ¡rios/integrados |
| `playwright`                       | 1.58.0  | Engine para chamadas e requisiÃ§Ãµes HTTP |
| `pytest-xdist`                     | 3.8.0   | Suporte Ã  execuÃ§Ã£o simultÃ¢nea e multiprocessos |
| `allure-pytest`                    | 2.15.3  | GeraÃ§Ã£o unificada de relatÃ³rios visuais com Allure |

---

## ğŸš€ InstalaÃ§Ã£o

### 1. Clone o repositÃ³rio

```bash
git clone https://github.com/reinaldorossetti/playwright-python-api-serverest.git
cd playwright-python-api-serverest
```

### 2. Crie e ative um ambiente virtual (Opcional, mas recomendado)

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### 3. Instale as dependÃªncias e o Playwright

```bash
pip install -r requirements.txt
playwright install
```

---

## â–¶ï¸ Executando os Testes

As configuraÃ§Ãµes padrÃ£o de execuÃ§Ã£o jÃ¡ estÃ£o prÃ©-definidas no `pytest.ini`.

### Executar suÃ­te completa

```bash
pytest
```

### Executar funcionalidade especÃ­fica (Ex: login)

```bash
pytest tests/login/test_login_playwright.py
```

### Executar teste individual

```bash
pytest tests/login/test_login_playwright.py::test_ct01_login_with_valid_credentials_and_validate_token
```

### ExecuÃ§Ã£o paralela (via pytest-xdist)

O arquivo `pytest.ini` jÃ¡ estÃ¡ setado com o argumento `-n 6 --dist=loadscope` configurando paralelismo otimizado com as workers. Para modificar em tempo de terminal para forÃ§ar execuÃ§Ã£o total da CPU, utilize `-n auto`:

```bash
pytest -n auto
```

---

## âš™ï¸ Esteira CI/CD - GitHub Actions

Este projeto possui integraÃ§Ã£o contÃ­nua configurada no GitHub Actions em:

- Arquivo: `.github/workflows/ci.yml`

### ğŸ” Quando a esteira Ã© executada

- `push` em qualquer branch
- `pull_request` aberto ou atualizado

### ğŸ§± Passos principais da pipeline (`test`)

1. **Checkout do cÃ³digo**
2. **ConfiguraÃ§Ã£o do Python** (`actions/setup-python@v4`)
3. **InstalaÃ§Ã£o das dependÃªncias** (utilizando `pip cache`)
4. **InstalaÃ§Ã£o dos browsers / dependÃªncias nativas do Playwright**
5. **ExecuÃ§Ã£o robusta via `pytest`** gerando artefatos para o Allure.
6. **Deploy no GitHub Pages:** RelatÃ³rio final Ã© hospedado usando `peaceiris/actions-gh-pages@v4`.

### ğŸŒ Acesso ao relatÃ³rio no GitHub Pages

ApÃ³s a execuÃ§Ã£o da sua pipeline, navegue em:
`https://reinaldorossetti.github.io/playwright-python-api-serverest/allure-reports/index.html`

---

## ğŸ“ Exemplos de Testes

### Exemplo 1: ConfiguraÃ§Ã£o Base com Pytest Fixtures (`conftest.py`)

Em Python, abstraÃ­mos todo o gerenciador em session scopes via fixtures.

```python
import pytest
from playwright.sync_api import Playwright, sync_playwright

BASE_URL = "https://serverest.dev"

@pytest.fixture(scope="session")
def playwright_instance() -> Playwright:
    with sync_playwright() as playwright:
        yield playwright

@pytest.fixture
def api_request(playwright_instance: Playwright):
    request_context = playwright_instance.request.new_context(base_url=BASE_URL)
    yield request_context
    request_context.dispose()
```

### Exemplo 2: Login com sucesso

```python
@allure.severity(allure.severity_level.CRITICAL)
def test_ct01_login_with_valid_credentials_and_validate_token(api_request: APIRequestContext):
    email = "usuario_valido@email.com"
    password = "SenhaSegura@123"

    login_resp = post_json(api_request, "/login", {"email": email, "password": password})

    assert login_resp.status == 200
    body = login_resp.json()
    assert body["message"] == "Login realizado com sucesso"
    assert body.get("authorization") is not None
```

### Exemplo 3: Login invÃ¡lido

```python
@allure.severity(allure.severity_level.CRITICAL)
def test_ct02_login_with_invalid_credentials(api_request: APIRequestContext):
    resp = post_json(
        api_request,
        "/login",
        {
            "email": "usuario@inexistente.com",
            "password": "senhaerrada",
        },
    )

    assert resp.status == 401
    response_body = resp.json()
    assert response_body["message"] == "Email e/ou senha invÃ¡lidos"
```

### Exemplo 4: ValidaÃ§Ã£o de campos obrigatÃ³rios (Data-driven com Pytest)

```python
@allure.severity(allure.severity_level.NORMAL)
@pytest.mark.parametrize("_row", load_required_fields_rows())
def test_ct03_validate_required_fields_on_login(_row: dict[str, str], api_request: APIRequestContext):
    resp = post_json(api_request, "/login", {"email": "", "password": "senha123"})
    assert resp.status == 400
    body = resp.json()
    assert body.get("email") is not None
```

### Exemplo 5: Uso de token dinÃ¢mico recebido em Auth

```python
@allure.severity(allure.severity_level.CRITICAL)
def test_ct04_login_and_use_token_in_protected_route(api_request: APIRequestContext):
    auth_token = "Bearer XXXX"  # Recebido de requests anteriores do setup

    product_payload = {"nome": "Teste", "preco": 100, "descricao": "Teste", "quantidade": 10}

    product_resp = api_request.post(
        "/produtos",
        headers={"Authorization": auth_token, "Content-Type": "application/json"},
        data=json.dumps(product_payload),
    )

    assert product_resp.status == 403
    assert product_resp.json()["message"] == "Rota exclusiva para administradores"
```

### Exemplo 6: Teste iterando em arquivos CSV via Pathlib

```python
def load_invalid_email_values() -> list[str]:
    # Utilizando Path do Python
    pass

@allure.severity(allure.severity_level.NORMAL)
@pytest.mark.parametrize("invalid_email", load_invalid_email_values())
def test_ct05_validate_invalid_email_format(invalid_email: str, api_request: APIRequestContext):
    resp = post_json(api_request, "/login", {"email": invalid_email, "password": "senha123"})

    assert resp.status == 400
    assert resp.json().get("email") is not None
```

---

## ğŸ¯ Funcionalidades e Sintaxe Nativas (Playwright Python API)

### 1. InicializaÃ§Ã£o de um contexto isolado

```python
request_context = playwright_instance.request.new_context(base_url="https://serverest.dev")
```

### 2. RequisiÃ§Ãµes Fluent e Options combinadas

```python
response = request.post(
    "/login",
    headers={"Content-Type": "application/json"},
    data={"email": email, "password": password}
)
```

### 3. ExtraÃ§Ã£o imediata JSON de responses HTTP

```python
body_json = response.json()
authorization_token = body_json.get("authorization")
http_status = response.status
```

---

## ğŸ“Š RelatÃ³rios

ApÃ³s aplicar localmente a suÃ­te ou durante a pipeline, o Allure se integra embutidamente com Pytest. O projeto aponta suas saÃ­das para o diretÃ³rio de dados em `/allure-results`.

Para transformar os dados JSON de saÃ­da do Pytest na interface grÃ¡fica robusta do allure:

```bash
allure serve allure-results
```

O dashboard exibe:
- âœ… CenÃ¡rios OK, Skipped e Failed detalhadamente
- â±ï¸ Tempos exatos capturados via Hooks do Pytest 
- ğŸ“‹ Stack Trace de Erros
- ğŸ“Š AnÃ¡lise das execuÃ§Ãµes em timeline

### ğŸ·ï¸ Exemplos de marcaÃ§Ãµes Allure nos Testes (Decorators)

O plugin `allure-pytest` suporta metadados extremamente ricos em cima das functions diretamente:

```python
import allure

@allure.severity(allure.severity_level.CRITICAL)
@allure.feature("Login")
@allure.story("Login com credenciais invÃ¡lidas")
@allure.description("Valida que o endpoint retorna 401 para credencial incorreta de usuÃ¡rio")
@allure.issue("SRV-123")
def test_ct02_login_with_invalid_credentials(api_request: APIRequestContext):
    with allure.step("Realizar post com credencial incorreta"):
        resp = api_request.post("/login", data={"email": "...", "password": "..."})

    with allure.step("Validar assert no status do endpoint login"):
        assert resp.status == 401
```

---

## ğŸ“ Boas PrÃ¡ticas

### 1. OrganizaÃ§Ã£o dos Arquivos de Tests / SuÃ­tes

- âœ… Divida os domÃ­nios (Ex: `login/test_login_playwright.py`, `users/test_users_playwright.py`, etc)
- âœ… Comece os nomes das funÃ§Ãµes validadoras com o prefixo `test_`, requisito estrutural bÃ¡sico para a descoberta automÃ¡tica de suÃ­tes pelo `pytest`.

### 2. FunÃ§Ãµes Abstratas Customizadas (`api_utils.py` e Helpers)

- âœ… Centralize chamadas longas na lÃ³gica customizada do projeto para evitar `copy/paste` nos testes (ex: `post_json`).
- âœ… Usar a biblioteca de Fake Entities (`faker`) isoladas em pacotes utilitÃ¡rios para construir mocks dinÃ¢micos de dados em cada request de teste de integraÃ§Ã£o.

### 3. Pytest Features:

- âœ… Usar exaustivamente propriedades como `@pytest.mark.parametrize` para simular as planilhas nativas em um Ãºnico method-call.
- âœ… ReutilizaÃ§Ã£o absoluta de Context API: Fixtures configuradas com Pytest que operam a API em sessions otimizam a rede e alivia o overhead das instÃ¢ncias locais do playwright.

---

## ğŸ“š Recursos Adicionais

### DocumentaÃ§Ã£o Oficial

- ğŸ­ **Playwright Python**: https://playwright.dev/python/docs/api/class-apirequestcontext
- ğŸŒ **ServeRest**: https://serverest.dev/
- ğŸ **Pytest**: https://docs.pytest.org/
- ğŸ“Š **Allure Pytest**: https://docs.qameta.io/allure/#_pytest

### Comunidade

- [Stack Overflow - Playwright Python Tag](https://stackoverflow.com/questions/tagged/playwright-python)
- [Playwright GitHub Issues](https://github.com/microsoft/playwright-python/issues)

---

## ğŸ¤ Contribuindo

ContribuiÃ§Ãµes sÃ£o bem-vindas! Para contribuir:

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/MinhaFeature`)
3. Commit suas mudanÃ§as (`git commit -m 'Adiciona nova feature'`)
4. Push para a branch (`git push origin feature/MinhaFeature`)
5. Abra um Pull Request

---

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ sob a licenÃ§a MIT. Veja o arquivo [LICENSE](LICENSE) para mais detalhes.

---

## ğŸ‘¨â€ğŸ’» Autor

Desenvolvido para fins de estudo e prÃ¡tica de automaÃ§Ã£o de testes de API.

---

## â­ Agradecimentos

- **Microsoft** - Criadora do Playwright
- **Paulo GonÃ§alves** - Criador da API ServeRest
- Equivalente e Comunidade ao Pytest - Testes automatizados robustos
- Comunidade open-source e testers

---

ReferÃªncias:
- https://playwright.dev/python/docs/intro
- https://docs.pytest.org/
- https://github.com/microsoft/playwright-python

**ğŸš€ Happy Testing with Playwright and Python!** ğŸ­
